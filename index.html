<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ë¹„ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 20px; background: #f0f2f5; }
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #ddd; font-weight: bold; }
        .tab-btn.active { background: #007bff; color: white; }
        .content { display: none; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .content.active { display: block; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .card { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .card-title { font-weight: bold; color: #007bff; font-size: 1.1em; }
        #calendar { max-width: 900px; margin: 0 auto; }
    </style>
</head>
<body>

    <div class="tab-menu">
        <button class="tab-btn active" onclick="openTab('search-tab')">1. ìì‚°ê²€ìƒ‰</button>
        <button class="tab-btn" onclick="openTab('place-tab')">2. ì¥ì†Œë³„</button>
        <button class="tab-btn" onclick="openTab('date-tab')">3. ë‚ ì§œë³„(ë‹¬ë ¥)</button>
    </div>

    <div id="search-tab" class="content active">
        <input type="text" id="assetSearch" placeholder="ìì‚°ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeyup="searchAsset()">
        <div id="searchResult"></div>
    </div>

    <div id="place-tab" class="content">
        <select id="placeSelect" onchange="filterByPlace()">
            <option value="">ì¥ì†Œ ì„ íƒ (ìˆ˜ì›, ì•„ì‚°1, í‰íƒ, ì‚¬ë¬´ì‹¤...)</option>
        </select>
        <div id="placeResult"></div>
    </div>

    <div id="date-tab" class="content">
        <div id="calendar"></div>
        <div id="dateResult" style="margin-top:20px;"></div>
    </div>

    <script>
        // ğŸ“¢ í˜•ë‹˜! ì‹œíŠ¸ 'ì›¹ì— ê²Œì‹œ(CSV)' ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ë”² ë„£ìœ¼ì‹­ì‡¼!
        const csvUrl = "ì—¬ê¸°ì—_êµ¬ê¸€ì‹œíŠ¸_CSV_ì£¼ì†Œë¥¼_ë³µì‚¬í•˜ì„¸ìš”";
        let rawData = [];

        async function init() {
            Papa.parse(csvUrl, {
                download: true, header: true,
                complete: function(results) {
                    rawData = results.data;
                    setupPlaceSelect();
                    setupCalendar();
                }
            });
        }

        // íƒ­ ì „í™˜
        function openTab(tabId) {
            document.querySelectorAll('.content, .tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            if(tabId === 'date-tab') window.dispatchEvent(new Event('resize')); 
        }

        // 1. ìì‚°ë²ˆí˜¸ ê²€ìƒ‰
        function searchAsset() {
            const val = document.getElementById('assetSearch').value.toLowerCase();
            const res = rawData.filter(row => row['ìì‚°ë²ˆí˜¸'] && row['ìì‚°ë²ˆí˜¸'].toLowerCase().includes(val));
            renderCards(res, 'searchResult');
        }

        // 2. ì¥ì†Œë³„ í•„í„°ë§
        function setupPlaceSelect() {
            const places = [...new Set(rawData.map(row => row['í˜„ì¬ìœ„ì¹˜']).filter(p => p))];
            const select = document.getElementById('placeSelect');
            places.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p; opt.innerText = p;
                select.appendChild(opt);
            });
        }
        function filterByPlace() {
            const val = document.getElementById('placeSelect').value;
            const res = rawData.filter(row => row['í˜„ì¬ìœ„ì¹˜'] === val);
            renderCards(res, 'placeResult');
        }

        // 3. ë‚ ì§œë³„ ë‹¬ë ¥ ì„¸íŒ…
        function setupCalendar() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                dateClick: function(info) {
                    showDateData(info.dateStr);
                },
                events: function(fetchInfo, successCallback) {
                    // ì‹œíŠ¸ì—ì„œ íŠ¹ì´ì‚¬í•­(ìˆ˜ë ¹, ë°˜ë‚© ë“±)ì´ ìˆëŠ” ë‚ ì§œë“¤ë§Œ ì  ì°ê¸°
                    let events = [];
                    rawData.forEach(row => {
                        for(let i=1; i<=31; i++) {
                            let status = row[`01 / ${i}`];
                            if(status && status.trim() !== "") {
                                events.push({ title: '!', start: `2025-01-${String(i).padStart(2, '0')}`, display: 'list-item' });
                            }
                        }
                    });
                    successCallback(events);
                }
            });
            calendar.render();
        }

        function showDateData(dateStr) {
            const day = parseInt(dateStr.split('-')[2]);
            const res = rawData.filter(row => row[`01 / ${day}`] && row[`01 / ${day}`].trim() !== "");
            const container = document.getElementById('dateResult');
            container.innerHTML = `<h3>${dateStr} ê¸°ë¡ ì¥ë¹„</h3>`;
            renderCards(res, 'dateResult', `01 / ${day}`);
        }

        function renderCards(data, targetId, dateCol = null) {
            const target = document.getElementById(targetId);
            target.innerHTML = data.map(row => `
                <div class="card">
                    <div class="card-title">${row['ìì‚°ë²ˆí˜¸']} (${row['ê¸°ê¸°ëª…'] || 'ê¸°ê¸°ëª… ì—†ìŒ'})</div>
                    <div>ğŸ“ í˜„ì¬ìœ„ì¹˜: ${row['í˜„ì¬ìœ„ì¹˜'] || '-'}</div>
                    <div>ğŸ“ ìƒíƒœ/íŠ¹ì´ì‚¬í•­: ${dateCol ? row[dateCol] : 'ì‹œíŠ¸ í™•ì¸ í•„ìš”'}</div>
                </div>
            `).join('') || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
        }

        init();
    </script>
</body>
</html>