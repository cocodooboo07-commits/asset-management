<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆê³ ì† ì¥ë¹„ê´€ë¦¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #f0f2f5; }
        .status-bar { background: #1e272e; color: #00d8d6; padding: 15px; font-weight: bold; text-align: center; border-bottom: 3px solid #00d8d6; position: sticky; top: 0; z-index: 100; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #00d8d6; border-radius: 8px; font-size: 18px; box-sizing: border-box; }
        .list-count { text-align: right; color: #666; font-size: 14px; margin-bottom: 5px; }
        #list { display: flex; flex-direction: column; gap: 10px; }
        .card { background: white; padding: 15px; border-radius: 10px; shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 10px solid #34e7e4; }
        .card-top { display: flex; justify-content: space-between; font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
        .memo-item { background: #fff5f5; padding: 8px; border-radius: 5px; margin-top: 5px; border: 1px solid #ff7675; font-size: 14px; }
        .highlight { color: #ff3f34; }
    </style>
</head>
<body>

<div class="status-bar" id="statusBar">ğŸš€ ì „ ë°ì´í„° ë™ê¸°í™” ëŒ€ê¸° ì¤‘...</div>
<input type="text" id="searchInput" placeholder="ìì‚°ë²ˆí˜¸, ì¥ë¹„ëª…, ì¥ì†Œ í†µí•© ê²€ìƒ‰!" onkeyup="fastSearch()">
<div class="list-count" id="listCount">ê²€ìƒ‰ ê²°ê³¼: 0ê±´</div>
<div id="list"></div>

<script>
    const sheetId = "12xhA0X6iOrg-4mq9KWZsQ9nPb2818P5VGUDXQMhjeTw";
    const sheetGids = [
        "1397804768","1226463543","1413774664","199554987","1627219985",
        "816640230","914024434","348975961","874684579","70160554",
        "811915899","1793948339","1112786","1052607410","503432091","734953362"
    ];

    let cacheData = [];

    async function forceSync() {
        const bar = document.getElementById('statusBar');
        bar.innerText = "â³ 16ê°œ ì‹œíŠ¸ íƒˆíƒˆ í„°ëŠ” ì¤‘...";
        
        const promises = sheetGids.map(gid => {
            return new Promise(resolve => {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}&cache=${Math.random()}`;
                Papa.parse(url, {
                    download: true, header: true, skipEmptyLines: true,
                    complete: res => resolve(res.data),
                    error: () => resolve([])
                });
            });
        });

        const allResults = await Promise.all(promises);
        cacheData = allResults.flat().filter(row => {
            // ìì‚°ë²ˆí˜¸ ë¹„ìŠ·í•˜ê²Œ ìƒê¸´ ì—´ì´ í•˜ë‚˜ë¼ë„ ìˆê³  ë‚´ìš©ì´ ìˆìœ¼ë©´ í•©ê²©
            return Object.values(row).some(v => v && v.length > 2);
        });

        bar.innerText = `âœ… ì´ ${cacheData.length}ê°œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ!`;
        fastSearch(); 
    }

    function fastSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const listDiv = document.getElementById('list');
        const countDiv = document.getElementById('listCount');
        
        // ê²€ìƒ‰ ì†ë„ ìµœì í™”: Filter + Map ì¡°í•©
        const filtered = cacheData.filter(row => {
            const rowString = JSON.stringify(Object.values(row)).toLowerCase();
            return rowString.includes(query);
        });

        countDiv.innerText = `ê²€ìƒ‰ ê²°ê³¼: ${filtered.length}ê±´`;
        
        listDiv.innerHTML = filtered.slice(0, 500).map(row => { // ìµœëŒ€ 500ê°œê¹Œì§€ë§Œ ë¨¼ì € ë Œë”ë§ (ì†ë„ ë•Œë¬¸)
            const keys = Object.keys(row);
            const assetKey = keys.find(k => k.includes('ìì‚°ë²ˆí˜¸')) || keys[0];
            const locKey = keys.find(k => k.includes('í˜„ì¬ìœ„ì¹˜')) || keys[1];
            
            // ë‚ ì§œ ê¸°ë¡ë§Œ ì¶”ì¶œ
            let memos = "";
            keys.forEach(k => {
                if(/\d{1,2}\/\d{1,2}/.test(k) && row[k] && row[k].trim()) {
                    memos += `<div class="memo-item"><b>${k}:</b> ${row[k]}</div>`;
                }
            });

            return `
                <div class="card">
                    <div class="card-top">
                        <span>ğŸ†” ${row[assetKey] || 'N/A'}</span>
                        <span>ğŸ“ ${row[locKey] || 'ìœ„ì¹˜ë¯¸ì •'}</span>
                    </div>
                    <div>${memos || '<span style="color:#ccc">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</span>'}</div>
                </div>
            `;
        }).join('');
    }

    forceSync();
</script>
</body>
</html>