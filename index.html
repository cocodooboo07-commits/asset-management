<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ - ì •ë°€ ë¶„ë¥˜</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Malgun Gothic', sans-serif; background: #f0f2f5; padding: 10px; }
    .header { background: #d63031; color: white; padding: 15px; text-align: center; font-weight: bold; border-radius: 10px; margin-bottom: 10px; }
    .box { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { font-size: 13px; font-weight: bold; color: #444; display: block; margin: 10px 0 5px 5px; }
    select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; background: #fff; }
    .card { background: #fff; padding: 15px; margin-bottom: 12px; border-radius: 10px; border-left: 10px solid #d63031; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .card-title { font-weight: bold; font-size: 14px; color: #222; margin-bottom: 5px; }
    .card-note { background: #fdf2f2; padding: 10px; border-radius: 6px; color: #d63031; font-size: 13px; border: 1px solid #ffcccc; font-weight: bold; white-space: pre-wrap; }
  </style>
</head>
<body>

<div class="header">ì¥ë¹„ ê´€ë¦¬ ì‹œìŠ¤í…œ (ì¥ì†Œ ê³ ì • ë¶„ë¥˜)</div>

<div class="box">
  <label>1. ì¥ë¹„ ì„ íƒ</label>
  <select id="selEquip" onchange="render()">
    <option value="">-- ì¥ë¹„ ì„ íƒ --</option>
  </select>
  
  <label>2. ì¥ì†Œ ì„ íƒ</label>
  <select id="selLoc" onchange="render()">
    <option value="">ì „ì²´ë³´ê¸°</option>
    <option value="1íŒ€">1íŒ€</option>
    <option value="2íŒ€">2íŒ€</option>
    <option value="3íŒ€">3íŒ€</option>
    <option value="4íŒ€">4íŒ€</option>
    <option value="5íŒ€">5íŒ€</option>
    <option value="6íŒ€">6íŒ€</option>
    <option value="ì˜ê³µì‹¤">ì˜ê³µì‹¤</option>
    <option value="ì‚¬ë¬´ì‹¤">ì‚¬ë¬´ì‹¤</option>
    <option value="ì•„ì‚°1">ì•„ì‚°1</option>
    <option value="ì„¼í„°">ì„¼í„°</option>
    <option value="í‰íƒ">í‰íƒ</option>
    <option value="ìˆ˜ì›">ìˆ˜ì›</option>
    <option value="ë¯¸ì…ë ¥">ë¯¸ì…ë ¥(ë¹ˆì¹¸)</option>
  </select>
</div>

<div id="results"></div>

<script>
const SID = '1qJpWnVNBZIwnwZG4OD3JdUKytVq_4V6n';
const SHEETS = {'ì²­ë ¥ê¸°':'1397804768','ì²­ë ¥ë¶€ìŠ¤':'1226463543','ì¤‘ì´ê¸°ê¸°':'1413774664','ì†ŒìŒê³„':'199554987','ì›ì‹¬ë¶„ë¦¬ê¸°':'1627219985','HRV':'816640230','EKG':'914024434','íí™œëŸ‰':'348975961','ì‹¤ë¦°ì§€':'874684579','í”„ë¦°í„°ê¸°':'70160554','ì—…ë¬´ìš©ë…¸íŠ¸ë¶':'811915899','ì™€ì´ë¸Œë¡œ':'1793948339'};
let allData = [];

// 1íŒ€(01/23) ê°™ì€ í…ìŠ¤íŠ¸ì—ì„œ '1íŒ€'ë§Œ ë½‘ì•„ë‚´ì„œ ë¶„ë¥˜ìš©ìœ¼ë¡œ ì”€
function getGroup(raw) {
    if(!raw || raw.trim() === "") return "ë¯¸ì…ë ¥";
    if(raw.includes("ì•„ì‚°")) return "ì•„ì‚°1";
    if(raw.includes("ì˜ê³µ")) return "ì˜ê³µì‹¤";
    if(raw.includes("ì‚¬ë¬´")) return "ì‚¬ë¬´ì‹¤";
    const teamMatch = raw.match(/([1-6])\s*íŒ€/);
    if(teamMatch) return teamMatch[1] + "íŒ€";
    const numMatch = raw.match(/[1-6]/);
    if(numMatch) return numMatch[0] + "íŒ€";
    return raw;
}

async function load() {
  const selE = document.getElementById('selEquip');
  for (const [name, gid] of Object.entries(SHEETS)) {
    selE.innerHTML += `<option value="${name}">${name}</option>`;
    try {
      const url = `https://docs.google.com/spreadsheets/d/${SID}/export?format=csv&gid=${gid}&t=${Date.now()}`;
      const res = await fetch(url);
      const csv = await res.text();
      const p = Papa.parse(csv.trim(), {header: true, skipEmptyLines: true});
      p.data.forEach(r => {
        const asset = r['ìì‚°ë²ˆí˜¸'] || r['ìì‚° ë²ˆí˜¸'];
        if(asset && asset.trim() !== "") {
          const rawLoc = (r['í˜„ì¬ìœ„ì¹˜'] || r['í˜„ì¬ ìœ„ì¹˜'] || "").trim();
          allData.push({ ...r, _type: name, _rawLoc: rawLoc, _group: getGroup(rawLoc), _asset: asset });
        }
      });
    } catch (e) {}
  }
}

function render() {
  const type = document.getElementById('selEquip').value;
  const loc = document.getElementById('selLoc').value;
  if(!type) return;

  let filtered = allData.filter(d => d._type === type);
  if(loc) {
    if(loc === 'ë¯¸ì…ë ¥') filtered = filtered.filter(d => d._group === 'ë¯¸ì…ë ¥');
    else filtered = filtered.filter(d => d._group === loc);
  }

  document.getElementById('results').innerHTML = filtered.map(d => {
    // 1. í˜„ì¬ìœ„ì¹˜ ì¹¸ì— ì íŒ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ì¶œë ¥ (ìµœìš°ì„ )
    let mainNote = d._rawLoc || "ê¸°ë¡ ì—†ìŒ";
    
    // 2. ë§Œì•½ í˜„ì¬ìœ„ì¹˜ ì¹¸ì´ ë¶€ì‹¤í•˜ë©´ ë‚ ì§œ ë¡œê·¸ ì¤‘ ìµœì‹  ê²ƒì„ ì°¾ìŒ
    let subNote = "";
    const logKeys = Object.keys(d).filter(k => k.match(/^\d{1,2}[\/\-]\d{1,2}$/)).sort((a,b)=>{
        const [am, ad] = a.split(/[\/\-]/).map(Number);
        const [bm, bd] = b.split(/[\/\-]/).map(Number);
        return (bm===1?13:bm)*100+bd - (am===1?13:am)*100+ad;
    });
    
    if(logKeys.length > 0 && d[logKeys[0]] && d[logKeys[0]].trim() !== "") {
        subNote = `${logKeys[0]} ê¸°ë¡: ${d[logKeys[0]]}`;
    }

    return `
      <div class="card">
        <div class="card-title">${d._group} / ${d._type} / ${d._asset}</div>
        <div class="card-note">ğŸ“ í˜„ì¬ìœ„ì¹˜: ${mainNote}${subNote ? '\nğŸ—“ï¸ ìµœì‹ ë¡œê·¸: ' + subNote : ''}</div>
      </div>`;
  }).join('');
}

load();
</script>
</body>
</html>