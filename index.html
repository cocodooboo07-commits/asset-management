<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥ë¹„ í†µí•© ê´€ë¦¬ ì•±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 15px; background: #f0f2f5; }
        .tab-menu { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { flex: 0 0 auto; padding: 12px 20px; cursor: pointer; border: none; background: #ccc; font-weight: bold; border-radius: 8px; }
        .tab-btn.active { background: #007bff; color: white; }
        .content { display: none; background: white; padding: 15px; border-radius: 10px; min-height: 400px; }
        .content.active { display: block; }
        input, select { width: 100%; padding: 15px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .card { border-left: 5px solid #007bff; background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card-title { font-weight: bold; font-size: 1.1em; color: #333; }
        .sheet-name { font-size: 0.8em; color: #007bff; margin-bottom: 5px; }
        .record-tag { display: inline-block; padding: 3px 8px; background: #e74c3c; color: white; border-radius: 4px; font-size: 0.8em; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="tab-menu">
        <button class="tab-btn active" onclick="openTab('search-tab')">ğŸ” ì „ì²´ê²€ìƒ‰</button>
        <button class="tab-btn" onclick="openTab('place-tab')">ğŸ“ ì¥ì†Œë³„ ê²€ìƒ‰</button>
        <button class="tab-btn" onclick="initCalendar(); openTab('date-tab')">ğŸ“… ë‚ ì§œë³„</button>
    </div>

    <div id="search-tab" class="content active">
        <input type="text" id="assetSearch" placeholder="ìì‚°ë²ˆí˜¸ ë˜ëŠ” ê¸°ê¸°ëª… ì…ë ¥..." onkeyup="searchAsset()">
        <div id="searchResult">ëª¨ë“  ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div id="place-tab" class="content">
        <select id="placeSelect" onchange="filterByPlace()">
            <option value="">ì¥ì†Œ ì„ íƒ</option>
            <option value="ìˆ˜ì›">ìˆ˜ì›</option>
            <option value="ì•„ì‚°1">ì•„ì‚°1</option>
            <option value="í‰íƒ">í‰íƒ</option>
            <option value="ì‚¬ë¬´ì‹¤">ì‚¬ë¬´ì‹¤</option>
        </select>
        <div id="placeResult"></div>
    </div>

    <div id="date-tab" class="content">
        <div id="calendar"></div>
        <div id="dateResult" style="margin-top:20px;"></div>
    </div>

    <script>
        const sheetId = "12xhA0X6iOrg-4mq9KWZsQ9nPb2818P5VGUDXQMhjeTw";
        // í˜•ë‹˜ì´ ë§ì”€í•˜ì‹  ëª¨ë“  ì‹œíŠ¸ ì´ë¦„ ë”² ë„£ì–´ë†¨ìŠµë‹ˆë‹¤.
        const sheetNames = ["ì„¤ë¬¸ì§€ ì‘ë‹µ ì‹œíŠ¸1", "ì²­ë ¥ê¸°", "ì²­ë ¥ë¶€ìŠ¤", "ì¤‘ì´ê¸°ê¸°", "ì†ŒìŒê³„", "ì›ì‹¬ë¶„ë¦¬ê¸°", "HRV", "EKG", "íí™œëŸ‰", "ì‹¤ë¦°ì§€", "í”„ë¦°í„°ê¸°", "ì—…ë¬´ìš©ë…¸íŠ¸ë¶", "ì™€ì´ë¸Œë¡œ", "ìˆ˜ì›", "ì•„ì‚°1", "í‰íƒ", "ì‚¬ë¬´ì‹¤"];
        
        let allCombinedData = [];

        async function init() {
            const fetchPromises = sheetNames.map(name => {
                return new Promise((resolve) => {
                    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(name)}`;
                    Papa.parse(url, {
                        download: true,
                        header: true,
                        complete: (results) => {
                            // ê° ë°ì´í„°ì— ì–´ë–¤ ì‹œíŠ¸ ì¶œì‹ ì¸ì§€ í‘œì‹œë¥¼ ë‚¨ê¹ë‹ˆë‹¤.
                            const taggedData = results.data.map(row => ({ ...row, _originSheet: name }));
                            resolve(taggedData);
                        },
                        error: () => resolve([]) // ì—ëŸ¬ë‚˜ë©´ ë¹ˆê°’ ë¦¬í„´
                    });
                });
            });

            const results = await Promise.all(fetchPromises);
            allCombinedData = results.flat().filter(row => row['ìì‚°ë²ˆí˜¸']);
            document.getElementById('searchResult').innerHTML = "ë°ì´í„° ë¡œë“œ ì™„ë£Œ! ê²€ìƒ‰ì„ ì‹œì‘í•˜ì„¸ìš”.";
        }

        function openTab(id) {
            document.querySelectorAll('.content, .tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function searchAsset() {
            const val = document.getElementById('assetSearch').value.toLowerCase();
            const res = allCombinedData.filter(row => 
                (row['ìì‚°ë²ˆí˜¸'] && row['ìì‚°ë²ˆí˜¸'].toString().toLowerCase().includes(val)) ||
                (row['ê¸°ê¸°ëª…'] && row['ê¸°ê¸°ëª…'].toLowerCase().includes(val))
            );
            render(res, 'searchResult');
        }

        function filterByPlace() {
            const val = document.getElementById('placeSelect').value;
            const res = allCombinedData.filter(row => row['í˜„ì¬ìœ„ì¹˜'] === val || row['_originSheet'] === val);
            render(res, 'placeResult');
        }

        let calendar = null;
        function initCalendar() {
            if (calendar) return;
            calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'ko',
                dateClick: (info) => showDateData(info.dateStr)
            });
            calendar.render();
        }

        function showDateData(dateStr) {
            const day = parseInt(dateStr.split('-')[2]);
            const colName = `01 / ${day}`;
            const res = allCombinedData.filter(row => row[colName] && row[colName].trim() !== "");
            document.getElementById('dateResult').innerHTML = `<h4>ğŸ“… ${dateStr} ê¸°ë¡ ì¥ë¹„</h4>`;
            render(res, 'dateResult', colName);
        }

        function render(data, targetId, col = null) {
            const target = document.getElementById(targetId);
            target.innerHTML = data.map(row => `
                <div class="card">
                    <div class="sheet-name">[ë¶„ë¥˜: ${row._originSheet}]</div>
                    <div class="card-title">${row['ìì‚°ë²ˆí˜¸']} (${row['ê¸°ê¸°ëª…'] || '-'})</div>
                    <div>ğŸ“ ìœ„ì¹˜: ${row['í˜„ì¬ìœ„ì¹˜'] || '-'}</div>
                    ${col ? `<div class="record-tag">ê¸°ë¡: ${row[col]}</div>` : ''}
                </div>
            `).join('') || 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
        }

        init();
    </script>
</body>
</html>